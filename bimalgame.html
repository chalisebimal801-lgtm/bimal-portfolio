<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Racing Game ‚Äî Realistic Car</title>
<style>
  html,body { height:100%; margin:0; background:#0b1a2b; font-family:Arial,Helvetica,sans-serif; }
  #gameContainer { width:100%; height:100vh; position:relative; overflow:hidden; }
  canvas { display:block; }

  /* HUD */
  #hud { position:absolute; left:12px; top:12px; z-index:40; background:rgba(0,0,0,0.5); color:#fff; padding:10px; border-radius:8px; font-size:14px; min-width:170px; }
  #hud div{ margin:6px 0; }
  button { background:#0aa; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-weight:700; }
  button:active{ transform:translateY(1px); }

  /* Controls panel */
  #controlsPanel {
    position:absolute; right:12px; top:12px; z-index:40;
    background:rgba(0,0,0,0.5); color:#fff; padding:12px; border-radius:8px; width:200px;
    font-size:13px; line-height:1.5;
  }

  /* overlays */
  .overlay{
    display:none; position:absolute; left:0; top:0; width:100%; height:100%;
    background:rgba(0,0,0,0.85); color:#fff; z-index:50; text-align:center; padding-top:140px;
  }
  .overlay button{ margin-top:20px; font-size:16px; padding:10px 16px; }
  .small { font-size:18px; margin-top:8px; color:#9be; }
</style>
</head>
<body>
<div id="gameContainer"></div>

<!-- HUD -->
<div id="hud">
  <div>Coins: <strong id="coinCount">0</strong></div>
  <div>Level: <strong id="level">1</strong></div>
  <div>Speed: <strong id="speed">0</strong></div>
  <div>Nitro: <strong id="nitroBar">100%</strong></div>
  <div style="margin-top:8px;">
    <button id="pauseBtn">Pause</button>
    <button id="restartBtn">Restart</button>
  </div>
</div>

<!-- Controls -->
<div id="controlsPanel">
  <strong>Controls</strong><br>
  ‚Üë / W : Forward<br>
  ‚Üì / S : Backward<br>
  ‚Üê / A : Left<br>
  ‚Üí / D : Right<br>
  Space : Nitro Boost<br>
  P : Pause / Unpause<br>
  <div class="small">Collect coins ‚Ä¢ Avoid obstacles & AI ‚Ä¢ Reach finish line</div>
</div>

<!-- overlays -->
<div id="gameOverOverlay" class="overlay">
  <div style="font-size:36px">üö® GAME OVER üö®</div>
  <div style="margin-top:18px;">Coins Collected: <strong id="finalCoins">0</strong></div>
  <div>Level Reached: <strong id="finalLevel">1</strong></div>
  <button id="gameOverRestartBtn">Restart Game</button>
</div>

<div id="winOverlay" class="overlay">
  <div style="font-size:36px">üèÜ YOU WIN üèÜ</div>
  <div style="margin-top:18px;">Coins Collected: <strong id="winCoins">0</strong></div>
  <div>Level Reached: <strong id="winLevel">1</strong></div>
  <button id="winRestartBtn">Play Again</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>
// --- BASIC SCENE ---
const container = document.getElementById('gameContainer');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b2433);
scene.fog = new THREE.FogExp2(0x0a2c43, 0.0012);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 4000);
camera.position.set(0,5,12);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio||1,2));
container.appendChild(renderer.domElement);

const hemi = new THREE.HemisphereLight(0xbfd1ff, 0x202040, 0.9);
scene.add(hemi);
const sun = new THREE.DirectionalLight(0xffffff,0.8);
sun.position.set(10,20,10); scene.add(sun);

// --- AUDIO ---
const AudioCtx = window.AudioContext||window.webkitAudioContext;
const audioCtx = new AudioCtx();
function playTone(f,d=0.1,t='sine',g=0.15){ try{const o=audioCtx.createOscillator();const ga=audioCtx.createGain();o.type=t;o.frequency.value=f;ga.gain.value=g;o.connect(ga);ga.connect(audioCtx.destination);o.start();ga.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+d);o.stop(audioCtx.currentTime+d);}catch(e){}}
function soundCoin(){playTone(1000,0.09,'triangle',0.08);}
function soundCrash(){playTone(120,0.25,'sawtooth',0.18);}
function soundNitro(){playTone(900,0.14,'sine',0.08);}
function soundWin(){playTone(1200,0.14,'triangle',0.12);}
function soundLose(){playTone(100,0.5,'sawtooth',0.18);}

// --- HUD VARIABLES ---
let keys={}, paused=false, level=1, coinCount=0, speed=0.28, nitro=100, nitroActive=false, nitroCooldown=false;
const raceDistance=1200; let distanceTraveled=0;
const coinEl=document.getElementById('coinCount'), levelEl=document.getElementById('level'), speedEl=document.getElementById('speed'), nitroEl=document.getElementById('nitroBar');
function updateHUD(){ coinEl.textContent=coinCount; levelEl.textContent=level; speedEl.textContent=Math.round(speed*100); nitroEl.textContent=Math.round(nitro)+'%'; }

// --- ROAD ---
const road = new THREE.Mesh(new THREE.BoxGeometry(10.6,0.2,2000), new THREE.MeshStandardMaterial({color:0x2d3036}));
road.position.y=0; scene.add(road);

// center stripes
for(let i=0;i<2000;i+=8){
  const stripe=new THREE.Mesh(new THREE.BoxGeometry(0.4,0.02,4), new THREE.MeshStandardMaterial({color:0xf7f7f7}));
  stripe.position.set(0,0.11,-i+2); scene.add(stripe);
}

// side rails
const leftRail=new THREE.Mesh(new THREE.BoxGeometry(0.4,0.4,2000),new THREE.MeshStandardMaterial({color:0x222a33})); leftRail.position.set(-5.3,0.25,-1000); scene.add(leftRail);
const rightRail=leftRail.clone(); rightRail.position.x=5.3; scene.add(rightRail);

// --- CAR ---
const car = new THREE.Group();
const chassisMat=new THREE.MeshStandardMaterial({color:0xff2d2d,metalness:0.6,roughness:0.25});
const bodyMain=new THREE.Mesh(new THREE.BoxGeometry(1.6,0.5,3.2),chassisMat); bodyMain.position.y=0.45; car.add(bodyMain);
const cabin=new THREE.Mesh(new THREE.BoxGeometry(1.2,0.35,1.5),new THREE.MeshStandardMaterial({color:0x111827,metalness:0.05,roughness:0.1})); cabin.position.set(0,0.75,-0.15); car.add(cabin);
const windowMat=new THREE.MeshStandardMaterial({color:0x6fb3ff,transparent:true,opacity:0.6});
const windshield=new THREE.Mesh(new THREE.BoxGeometry(1.08,0.25,0.45),windowMat); windshield.position.set(0,0.8,0.6); car.add(windshield);
function makeWheel(x,z){ const w=new THREE.Mesh(new THREE.CylinderGeometry(0.32,0.32,0.35,24), new THREE.MeshStandardMaterial({color:0x0b0b0b})); w.rotation.z=Math.PI/2; w.position.set(x,0.17,z); car.add(w);}
makeWheel(-0.8,-1.1); makeWheel(0.8,-1.1); makeWheel(-0.8,1.1); makeWheel(0.8,1.1);
const headlight=new THREE.Mesh(new THREE.BoxGeometry(0.15,0.12,0.06),new THREE.MeshStandardMaterial({color:0xffffee,emissive:0xfff3d9,emissiveIntensity:0.2}));
headlight.position.set(-0.35,0.45,1.75); car.add(headlight); const headlight2=headlight.clone(); headlight2.position.x=0.35; car.add(headlight2);
const nitroLight=new THREE.PointLight(0x22aaff,0,8,2); nitroLight.position.set(0,0.5,-1.8); car.add(nitroLight);
car.position.set(0,0.18,0); scene.add(car);

// --- OBJECTS ---
const coins=[], aiCars=[], obstacles=[];
function spawnCoin(z){ const c=new THREE.Mesh(new THREE.IcosahedronGeometry(0.22,1), new THREE.MeshStandardMaterial({color:0xffd24d,emissive:0x552200})); c.position.set((Math.floor(Math.random()*3)-1)*3,0.4,z); scene.add(c); coins.push(c);}
function spawnAICar(z){ const a=new THREE.Mesh(new THREE.BoxGeometry(1,0.45,2.2), new THREE.MeshStandardMaterial({color:Math.random()*0xcccccc})); a.position.set((Math.floor(Math.random()*3)-1)*3,0.2,z); scene.add(a); aiCars.push(a);}
function spawnObstacle(z){ const o=new THREE.Mesh(new THREE.BoxGeometry(1.2,0.5,2.6), new THREE.MeshStandardMaterial({color:0xff6b6b})); o.position.set((Math.floor(Math.random()*3)-1)*3,0.25,z); scene.add(o); obstacles.push(o);}
for(let i=60;i<raceDistance;i+=28){ spawnAICar(-i + (Math.random()*6-3)); if(i%42===0) spawnObstacle(-i + (Math.random()*6-3)); spawnCoin(-i - 6 + (Math.random()*10 -5)); }

// --- COLLISION ---
function approxCollide(a,b,t=0.9){ return Math.abs(a.position.x-b.position.x)<t && Math.abs(a.position.z-b.position.z)<t;}

// --- GAME LOOP ---
let lastTime = performance.now();
function animate(now){
  requestAnimationFrame(animate);
  const dt=Math.min(0.06,(now-lastTime)/1000); lastTime=now;
  if(!paused){
    distanceTraveled+=speed;
    // move car
    car.position.z-=speed;
    if(keys['ArrowLeft']||keys['a']||keys['A']) car.position.x-=0.12;
    if(keys['ArrowRight']||keys['d']||keys['D']) car.position.x+=0.12;
    car.position.x=Math.max(-4,Math.min(4,car.position.x));
    // camera follow
    camera.position.x += (car.position.x - camera.position.x)*0.12;
    camera.position.z = car.position.z + 10;
    camera.position.y = 5;
    camera.lookAt(car.position.x,0.8,car.position.z);
    // move AI
    aiCars.forEach(a=>{ a.position.z+=0.16; if(a.position.z>car.position.z+10){ a.position.z=car.position.z-200; a.position.x=(Math.floor(Math.random()*3)-1)*3;} if(approxCollide(a,car,1)) { gameOver(); soundCrash(); }});
    obstacles.forEach(o=>{ o.position.z+=0.14; if(o.position.z>car.position.z+10){ o.position.z=car.position.z-200; o.position.x=(Math.floor(Math.random()*3)-1)*3;} if(approxCollide(o,car,1)) { gameOver(); soundCrash(); }});
    for(let i=coins.length-1;i>=0;i--){ if(approxCollide(coins[i],car,0.9)){ scene.remove(coins[i]); coins.splice(i,1); coinCount++; soundCoin(); if(coinCount%8===0){level++; speed=Math.min(0.62,speed+0.03);} } }
    if(Math.abs(car.position.z)>=raceDistance){ winGame(); }
  }
  updateHUD();
  renderer.render(scene,camera);
}
requestAnimationFrame(animate);

// --- INPUT ---
window.addEventListener('keydown',e=>{ if(audioCtx.state==='suspended') audioCtx.resume().catch(()=>{}); keys[e.key]=true; if(e.key==='p'||e.key==='P') paused=!paused; if(e.code==='Space'){ nitroActive=true; setTimeout(()=>{ nitroActive=false;},1000); }});
window.addEventListener('keyup',e=>{ keys[e.key]=false; });
document.getElementById('pauseBtn').addEventListener('click',()=>paused=!paused);
document.getElementById('restartBtn').addEventListener('click',()=>location.reload());
document.getElementById('gameOverRestartBtn').addEventListener('click',()=>location.reload());
document.getElementById('winRestartBtn').addEventListener('click',()=>location.reload());
window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight);});

// --- GAME OVER & WIN ---
function gameOver(){ if(paused) return; paused=true; document.getElementById('finalCoins').innerText=coinCount; document.getElementById('finalLevel').innerText=level; document.getElementById('gameOverOverlay').style.display='block'; soundLose(); }
function winGame(){ if(paused) return; paused=true; document.getElementById('winCoins').innerText=coinCount; document.getElementById('winLevel').innerText=level; document.getElementById('winOverlay').style.display='block'; soundWin(); }
updateHUD();
</script>
</body>
</html>
